üìåüìå """–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –±–æ–ª—å—à–æ–π —Ç–∞–±–ª–∏—Ü—ã
–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
""" 
‚úÖ
import mysql.connector
import random

# pip install faker - —É–¥–æ–±–Ω—ã–π –ø–∞–∫–µ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
from faker import Faker
from time import time

from local_settings import dbconfig


# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
TABLE_NAME = 'big_table'
NUM_ROWS = 10_000_000  # –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å
BATCH_SIZE = 10_000    # –ø–∞–∫–µ—Ç–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
fake = Faker()

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
with mysql.connector.connect(**dbconfig) as conn:
    with conn.cursor() as cursor:

        # –°–æ–∑–¥–∞—ë–º –î–ë, –µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ—Ç
        cursor.execute("CREATE DATABASE IF NOT EXISTS testdb;")
        cursor.execute("USE testdb;")

        # –£–¥–∞–ª–∏–º —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å
        cursor.execute(f"DROP TABLE IF EXISTS {TABLE_NAME}")

        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        cursor.execute(f"""
            CREATE TABLE {TABLE_NAME} (
                id BIGINT AUTO_INCREMENT PRIMARY KEY,
                name VARCHAR(255),
                email VARCHAR(255),
                age INT,
                created_at DATETIME
            )
        """)

        # –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞–º–∏
        def insert_batch():
            for i in range(0, NUM_ROWS, BATCH_SIZE):
                values = []
                for _ in range(BATCH_SIZE):
                    name = fake.name()
                    email = fake.email()
                    age = random.randint(18, 90)
                    created_at = fake.date_time_between(start_date='-5y', end_date='now')
                    values.append((name, email, age, created_at))
                cursor.executemany(
                    f"INSERT INTO {TABLE_NAME} (name, email, age, created_at) VALUES (%s, %s, %s, %s)",
                    values
                )
                print(f"[{i + BATCH_SIZE:,}/{NUM_ROWS:,}] –∑–∞–ø–∏—Å–µ–π –≤—Å—Ç–∞–≤–ª–µ–Ω–æ")

        # –ü–æ–¥—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
        start = time()
        insert_batch()
        print(f"‚úÖ –î–∞–Ω–Ω—ã–µ –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–∞ {time() - start:.2f} —Å–µ–∫.")
