üî∏üî∏üî∏ –ú–û–ñ–ù–û –õ–ï–ì–ö–û –ü–†–û–ñ–ò–¢–¨ –ò –ë–ï–ó FOREIGN KEY üî∏üî∏üî∏

‚úÖ‚úÖ –°–æ–∑–¥–∞–¥–∏–º –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã, –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –∑–∞–∫–∞–∑—ã:

‚úÖ CREATE TABLE goods (
    id INT PRIMARY KEY,
    name VARCHAR(30) NOT NULL
);

‚úÖ CREATE TABLE orders (
    id INT PRIMARY KEY,
    quantity INT NOT NULL,
    product_id INT -- –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ
);
–î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:

‚úÖ INSERT INTO goods (id, name) VALUES (1, '–¢–µ–ª–µ—Ñ–æ–Ω');

INSERT INTO orders (id, quantity, product_id) VALUES 
(1, 5, 1), -- 5 —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
(2, 2, 2); -- 2 –Ω–æ—É—Ç–±—É–∫–∞

‚úÖ –ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–µ—Ç FOREIGN KEY, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –ª—é–±—ã–µ product_id, –¥–∞–∂–µ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ goods. –ß—Ç–æ –æ—á–µ–≤–∏–¥–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –û–ì–†–û–ú–ù–£–Æ –ø—Ä–æ–±–ª–µ–º—É: –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å
–≤ —Ç–∞–±–ª–∏—Ü—É orders –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –º—ã –ø–æ–ª—É—á–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä. –¢–æ –µ—Å—Ç—å –æ—à–∏–±–∫—É.

‚úÖ –ü–†–ò–ú–ï–† –° FK (–û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –ù–ê –î–û–ë–ê–í–õ–ï–ù–ò–ï)
–£–¥–∞–ª–∏–º —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é —Ç–∞–±–ª–∏—Ü—ã orders –∏ —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é:

CREATE TABLE orders (
    id INT PRIMARY KEY,
    quantity INT NOT NULL,
    product_id INT,
    FOREIGN KEY (product_id) REFERENCES goods(id)
);
–¢–µ–ø–µ—Ä—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∞—è —Å–≤—è–∑—å: –≤ product_id –º—ã –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ–º –≤—Å—Ç–∞–≤–∏—Ç—å –ª—é–±–æ–π –∏–Ω–¥–µ–∫—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–∑–±—Ä–µ–¥—ë—Ç –Ω–∞–º –≤ –≥–æ–ª–æ–≤—É. –ò–±–æ –ø–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–µ–∫—Å –≤ —Ç–∞–±–ª–∏—Ü–µ goods –≤—ã–∑–æ–≤–µ—Ç –∑–∞–ø—Ä–µ—Ç —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —ç—Ç—É –≤—Å—Ç–∞–≤–∫—É.

INSERT INTO orders (id, quantity, product_id) VALUES 
(1, 5, 1), -- 5 —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
(2, 2, 2); -- 2 –Ω–æ—É—Ç–±—É–∫–∞

ERROR: Cannot add or update a child row: a foreign key constraint fails.
–ß—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –ª–æ–≥–∏—á–Ω–æ: –ø—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å –ø—Ä–æ–¥–∞–≤–∞—Ç—å –Ω–æ—É—Ç–±—É–∫–∏, –∏—Ö —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É goods:


‚úÖ INSERT INTO goods (id, name) VALUES (2, '–ù–æ—É—Ç–±—É–∫');
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑—ã –∏ –∏–Ω–¥–µ–∫—Å–æ–º 2 (–Ω–æ—É—Ç–±—É–∫) –¥–æ–±–∞–≤—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É orders –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø—Ä–æ–±–ª–µ–º:

INSERT INTO orders (id, quantity, product_id) VALUES 
(1, 5, 1), -- 5 —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
(2, 2, 2); -- 2 –Ω–æ—É—Ç–±—É–∫–∞
–ë–æ–ª–µ–µ –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± "–∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –∫–ª—é—á–∞—Ö" –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞: https://dev.mysql.com/doc/refman/8.4/en/create-table-foreign-keys.html

–ó–¥–µ—Å—å –∂–µ –æ—Ç–º–µ—Ç–∏–º —Ç–æ–ª—å–∫–æ —Ç—Ä–∏ –º–æ–º–µ–Ω—Ç–∞:

‚úÖ 1. –ù–ê–î–û –õ–ò –î–ê–í–ê–¢–¨ –°–û–ë–°–¢–í–ï–ù–ù–´–ï –ò–ú–ï–ù–ê –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø–ú?
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–æ–æ–±—â–µ, –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FOREIGN KEY –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –µ—Å—Ç—å —Å–º—ã—Å–ª —Å—Ä–∞–∑—É –∂–µ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–¥ –µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º. –ù–∞–ø—Ä–∏–º–µ—Ä: fk_orders_goods.

CREATE TABLE orders (
    id INT PRIMARY KEY,
    quantity INT NOT NULL,
    product_id INT,
    CONSTRAINT fk_orders_goods FOREIGN KEY (product_id) REFERENCES goods(id)
);

–ó–∞—á–µ–º? –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç —É–¥–∞–ª–µ–Ω–∏–µ / –∏–∑–º–µ–Ω–µ–Ω–∏–µ FOREIGN KEY –≤ –±—É–¥—É—â–µ–º, –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç —Ç–∞–∫–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.

üìå 2. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ù–°–¢–†–£–ö–¶–ò–ô ON DELETE / ON UPDATE
–ï—Å–ª–∏ –Ω–æ—É—Ç–±—É–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã goods —É–¥–∞–ª—è—Ç—Å—è, —Ç–æ —ç—Ç–æ –Ω–∞—Ä—É—à–∏—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∑–∞–∫–∞–∑–æ–≤: –∑–∞–∫–∞–∑—ã —Å–Ω–æ–≤–∞ –Ω–∞—á–Ω—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã (—Å—Å—ã–ª–∫–∏) –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏.

–ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –º—ã –¥–æ–ª–∂–Ω—ã

–ª–∏–±–æ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤,

–ª–∏–±–æ —É–¥–∞–ª—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–∫–∞–∑–∞–º–∏, –≥–¥–µ –æ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è,

–ª–∏–±–æ –∑–∞–º–µ–Ω—è—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç —á–µ–º-—Ç–æ –¥—Ä—É–≥–∏–º.

–ö–∞–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ª—É—á—à–µ –≤—ã–±—Ä–∞—Ç—å, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–ª—É—á–∞–∏ –∂–∏–∑–Ω–∏.

üìå –í–∞—Ä–∏–∞–Ω—Ç—ã:

‚úÖ ON DELETE CASCADE	–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ.
‚úÖ ON DELETE SET NULL	–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è product_id/customer_id –≤ orders —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è NULL.
‚úÖ ON DELETE RESTRICT	(–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é). –ï—Å–ª–∏ –≤ orders –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏, —É–¥–∞–ª–µ–Ω–∏–µ goods/customers –∑–∞–ø—Ä–µ—â–µ–Ω–æ.
‚úÖ ON DELETE NO ACTION	–ö–∞–∫ RESTRICT, –Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–≤–∏–∂–∫–∞ –ë–î.
‚úÖ ON UPDATE CASCADE	–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ id –≤ goods/customers –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ orders.
‚úÖ ON UPDATE SET NULL	–ï—Å–ª–∏ id –∏–∑–º–µ–Ω–∏–ª—Å—è –≤ goods/customers, –≤ orders —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è NULL.


‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

sql
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
CREATE TABLE orders (
    id INT PRIMARY KEY,
    quantity INT NOT NULL,
    product_id INT,
    customer_id INT,
    CONSTRAINT fk_orders_goods FOREIGN KEY (product_id) REFERENCES goods(id) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE
);

üìåüìå–ß–¢–û –î–ê–Å–¢ –î–û–ë–ê–í–õ–ï–ù–ò–ï CASCADE, SET NULL –ò–õ–ò RESTRICT?

CASCADE ‚Äî –µ—Å–ª–∏ —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–≤–∞—Ä, —É–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞–∫–∞–∑—ã –Ω–∞ –Ω–µ–≥–æ.

SET NULL ‚Äî –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–¥–∞–ª—ë–Ω, –∑–∞–∫–∞–∑—ã –æ—Å—Ç–∞—é—Ç—Å—è, –Ω–æ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏.

RESTRICT / NO ACTION ‚Äî —á—Ç–æ–±—ã –Ω–µ–ª—å–∑—è —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

üìå –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å–Ω–æ–≤–∞ –∑–¥–µ—Å—å: https://dev.mysql.com/doc/refman/8.4/en/create-table-foreign-keys.html

üìå –ö–ê–ö –ü–û–°–ú–û–¢–†–ï–¢–¨ –ù–ê –°–¢–†–£–ö–¢–£–†–£ –°–£–©–ï–°–¢–í–£–Æ–©–ï–ô –¢–ê–ë–õ–ò–¶–´?

‚úÖ 1. –ù–∞–∂–∞—Ç—å –Ω–∞ —Ç–∞–±–ª–∏—Ü—É –≤ —Å—Ö–µ–º–∞—Ö Workbench –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥ —Å—Ö–µ–º–∞–º–∏
python
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
Table: orders

Columns:
	id	int PK
	quantity	int
	product_id	int

‚úÖ 2. DESCRIBE table_name:
sql
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
# Field     Type    Null    Key     Default     Extra
id	        int	    NO	    PRI		
quantity	int	    NO			
product_id	int	    YES	    MUL	

‚úÖ 3. SHOW CREATE TABLE table_name:
sql
–ö–æ–ø—ñ—é–≤–∞—Ç–∏
–†–µ–¥–∞–≥—É–≤–∞—Ç–∏
CREATE TABLE `orders` (
  `id` int NOT NULL,
  `quantity` int NOT NULL,
  `product_id` int DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `product_id` (`product_id`),
  CONSTRAINT `orders_ibfk_1` FOREIGN KEY (`product_id`) REFERENCES `goods` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci








