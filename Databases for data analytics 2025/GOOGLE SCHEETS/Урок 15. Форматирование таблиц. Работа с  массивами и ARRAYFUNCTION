Урок 15. Форматирование таблиц. Работа с массивами и ARRAYFUNCTION
  
Форматирование текста
 Набор данных
 Познакомимся сперва с набором данных на котором будем изучать аспекты
 форматирования в таблицах.
 Перед нами отчет за период работы некой организации.
 Перед началом периода были уточнены некоторые бюджетный категории по
 департаментам и сейчас вы помогаете подготовить данные к встрече менеджмента
 для анализа работы организации в этом периоде.
 Department- название департамента организации
 Category- бюджетная категория, по которой были приняты изменения перед
 началом периода
 Budget- сумма бюджета на категорию департамента в $
 Actuals- сумма фактических расходов на категорию в $
 Выравнивание текста
 Первое, что бросается в глаза, это то, что колонки с финансовой информацией
 имеют отличающееся выравнивание в данных и заголовке.
 Изменим выравнивание заголовков.
Для этого выделим текст заголовков Budget и Actuals b используем меню
 Format→Alignment→Right
 В результате получим более аккуратно выглядящее колонки в таблице.
Аналогично выполнить эту операцию можно было из панели инструментов
 ● Ctrl+Shift+L- выравнивание по левому краю
 ● Ctrl+Shift+E- выравнивание по центру
 ● Ctrl+Shift+R- выравнивание по правому краю
 Перенос текста
 При подготовке отчета выяснилось, что некоторые бюджетные статьи были
 превышены и менеджеры соответствующих департаментов представили в документ
 свои пояснения причин (колонка Notes). Однако текст не очень хорошо помещается
 в ячейки из-за своего размера.
Вэтомслучаемыможемвоспользоватьсяоднимиз3вариантоврешения:
 ● оставитькакесть(текстпересекаетграницыячейки)
 ● обрезать текст на границеячейкиинапримернемногоувеличитьразмер
 ячейки.
 ● сделатьформаттекстамногострочнымирасширитьячейку
 Пересечение Ограчничение Пренос
Тежеоперацииможновыполнитьизпанелиинструментов.
 Вслучае,еслимыиспользуемвариантпереноса,имеетсмыслобратитьвнимание,
 как выглядят другие ячейки в этой же строке. В частности вертикальное
 выравниваниетекста.
 Низ
 Центр
 Верх
 Мнеличнобольшенравитсявариантсвыравниваниемвверх.
 ДляэтогомывыделяемнужныенамячейкииизменюFormat→Alignmentвыбираем
 вариантTop:
Также эта операция доступна из панели инструментов.
 Вращение текста
 Если нам кажется целесообразным, мы также можем располагать текст или
 названия заголовков под углом относительно горизонтального расположения.
Напримеркакэтотвариантснебольшимуклономмогбывыглядетьвтаблице.
 При необходимости можно задавать произвольный угол наклона в панели
 инструментов:
Копирование формата
 Когда мы завершили форматировать первую строку данных мы можем легко
 применить понравившийся нам формат для всех остальных строк таблицы с
 помощью инструмента копирования формата.
 Для этого необходимо выделить диапазон ячеек 1, формат которых мы хотим
 перенести на другие ячейки.
 А потом выбрать инструмент копирования формата 2
 Далее выделить диапазон ячеек куда мы хотим применить формат.
Форматбудетскопированнавыделенныеячейки.
 Продемонстрироватьстудентамкопированиеформата:
Задание для закрепления
 Отформатировать таблицу на листе Budget Formatting:
 ● Используя выравнивание
 ● Перенос
 ● Вращениетекста
 ● Скопировать формат на все ячейки таблицы
Использование цвета и тем для улучшения
 восприятия данных в таблице
 Для более удобного восприятия данных в таблице стоит также рассмотреть вариант
 использования одного из двух вариантов цветового форматирования: чередование
 цветов и темы.
 Чередование цветов
 Таблица гораздо легче читается если строки выделены слегка отличающимся
 цветом. В таком случае глаз легче находит данные расположенные на одной строки
 и становится проще анализировать значения.
 Выделим все ячейки таблицы на листе Budget Formatting и выберем пункт меню
 Format→Alternating colors:
 В появившейся справа панели мы можем выбирать один из встроенных 1
 вариантов цветовой расцветки либо назначить свой собственный 2.
Применимодинизвстроенныхвариантов.
Добавим в таблицу строку Итого и применим к ней этот же формат.
 В первую очередь изменим диапазон 1, к которому применяется чередование
 цветов.
 Далее включим форматирование “подвала” таблицы- Footer 2 и убедимся что
 выбранный нами цвет ячеек применяется 3.
Неправдали,сталонамноголегчевосприниматьинформацию?
Темы
 Еще одной альтернативой является применение Темы.
 В менюFormat→Theme
 Если чередование цветов влияет напрямую на расцветку строк таблицы, то
 выбранная тема влияет на шрифт и цвета используемые в сводных таблицах и
 графиках.
 Построим для примера сводную таблицу и график и применим одну из встроенных
 тем.

Задание для закрепления
 ● Применитьчередование цветов к таблице
 ● ДобавитьFooter и включить его в диапазон чередования цветов
 ● ПрименитьТему на выбор
Условное форматирование
 Часто на практике можно встретить использование условного форматирования для
 улучшения восприятия данных в таблице и расставления акцентов на интересующих
 аспектах.
 Условное форматирование Conditional Formatting) в Google Sheets- это
 функциональность, которая позволяет автоматически изменять внешний вид
 ячеек и диапазонов ячеек в зависимости от выполнения определенных условий
 иликритериев.
 Условное форматирование делает таблицы более информативными и помогает
 выделить ключевую информацию.
 Условия по тексту
 Для примера выделим все департаменты, названия которых начинаются на Pro.
 Это будет Production и Procurement.
 Для этого выделим колонку Department и в меню выберем пункт Format→Conditional
 formatting
В боковой панели настроек форматирования, на вкладке Single Color 1 из
 выпадающегоменювыберемусловиеTextcontains 2 инапишемзначениеPro 3.
 Выберемвариант,чтодолжнопроизойтисформатомячейкивслучаееслиусловие
 выполняется(еслионоИстинно).Дляпримерапоменяемцветзаливкиячейки 4.
Условия по числу
 Также можно задавать условия по дате, числу, проценту.
 Для примера добавим колонку Difference которая содержит разницу между Actuals и
 Budget.
 И добавим условное форматирование всех ячеек, где Difference больше 0- то есть
 бюджет был превышен. Это позволит визуально увидеть, по каким категориям и по
 каким департаментам стоит провести анализ затрат.
 Для этого выделим ячейку Difference и создадим новое правило условного
 форматирования.
Мывидимчто все ячейки, где Difference более чем 0 стали с красноватым фоном.
 Ого! У нас много где бюджет превышен.
 Цветовая палитра
 Пока мы рассматривали примеры использования только одного цвета для
 форматирования по условию.
Когда есть большое количество данных одинаковой сути, но разных по значению
 имеет смысл вводить градацию цвета для расставления акцентов.
 К примеру важно обращать внимание не просто на факт превышения бюджета, а на
 процент превышения по отношению к изначальному бюджету.
 Для этого используем инструмент Цветовая палитра Color scale).
 Создадим еще одну колонку Difference % в которой посчитаем % превышения
 бюджета, как Difference / Budget:
 И для всей колонки Difference % применим новое правило условного
 форматирования.
 Выберем вкладку Color scale 1
 Выберем шкалу от зеленого до красного 2 и установим срединное значение в 0,
 указывая, что все значения ниже ноля должны быть зелеными, а выше- красными
 3.
Теперь таблица стала еще более наглядной.
 Теперь глаз замечает не только сам факт превышения бюджета, но и акцентирует
 внимание на размере превышения относительно самого бюджета.
Форматирование строки при помощи формулы
 Часто бывают ситуации, когда есть необходимость выделить цветом всю строку, а
 не только отдельную ячейку в ней. Для этого мы воспользуемся условным
 форматированием по произвольной формуле.
 Ее особенность в том, что мы можем формулой проверять условие в одной ячейке,
 а применять форматирование в другой.
 Для примера сделаем правило по которому выделим строки, где бюджет превышен
 более чем на 10 % и более чем на 10 000 долларов.Отметим такие строки жирным
 красным текстом, чтобы не смешивать эту окраску с другими правилами условного
 форматирования, которые уже работают у нас на таблице.
 Для реализации такого подхода создадим новое правило условного
 форматирования.
 Тип форматирования Custom formula is 1
 Сама формула будет выглядеть так 2
 AND$F2 0.1, $E2 10000
 Важно использовать знак = для формулы и $ для фиксации колонки.
 Применим к ячейкам, где выполняется условие формулы форматирование жирным
 текстом 3 исделаем текст красным 4.
Теперь акцент внимания будет в первую очередь на самой проблемной категории.
Задание для закрепления
 1. Создать копию Budget Formatting:
 ○ Создатьколонку Difference как разницу между Actuals и Budget.
 ○ Создатьколонку Difference % как отношение Difference к Budget.
 ○ Создатьпростое правило расцветки ячейки если Difference > 10000.
 ○ Создать правило Color Scale для Difference % с средним пороговым
 значением 0.
 2. Создать формулу форматирования всей строки фиолетовой заливкой в случае
 если:
 ○ Бюджетнепревышен 0.
Массивыиихиспользование
 В Google Sheets все данные представлены в виде ячеек которые расположены по
 строкам и столбцам. Фактически эта структура данных- двумерная матрица, или
 двумерный массив.
 В большинстве примеров до этого мы почти не использовали массивы в качестве
 параметров или констант.
 Давайте восполним это упущение и получим новый навык.
 Сейчас или никогда! :)
 Массив–этотаблицазначений,состоящаяизстрокистолбцов.
 Массивом является любой диапазон ячеек.
 Вы также можете создать в формуле собственные массивы, используя фигурные
 скобки { } для группировки значений. Порядок, в котором будут показываться
 значения, определяется знаками пунктуации. Они описаны ниже.
 ● Запятая. Позволяет разделять данные по столбцам при записи строки в
 массиве. В примере 1, 2 цифра 1 будет помещена в первую ячейку, а цифра
 2– всоседнюю ячейку справа.
 ● Точка с запятой. Отделяет строки при записи столбцов в массив. В примере
 1; 2 цифра 1 будет помещена в первую ячейку, а цифра 2– в соседнюю
 ячейку под ней.
 Пример массива из 3 строк в каждой из которых по 2 столбца:
 1,2; 3, 4; 5, 6
 В тех странах, где десятичным разделителем служит запятая, при создании массива
 используется косая черта вместо запятой.
 Для ru_RU
 1\2; 3\4
 en_US
 1,2; 3,4
 Для чего использовать массивы?
 Вот несколько вариантов:
 ● Длясоздания временных списков значений, которые не хранятся в ячейках.
 ● Для выполнения операций сразу над несколькими значениями, без
 необходимости ссылаться на ячейки.
 ● Дляпереиспользования диапазонов ячеек на другом листе данных.
 ● Для создания компактных таблиц с расчетами используя массивы и
 комбинируя с ARRAYFORMULA для вычислений
 ● Дляпередачисоставных параметров в функции поиска и фильтрации.
● Для создания комбинированных формул, где результат работы вложенной
 функции- это массив данных, который передается как параметр в
 родительскую функцию.
 Основы работы с массивами
 Создание литерала
 В ячейку A3 внесем формулу:
 ={1,2; 3, 4; 5, 6}
 Она создает в диапазоне ячеек A3B5 двумерный массив с данными.
 Как видно данные из ячейки A3 были распространены на остальные ячейки
 диапазона.
 Важно, чтобы в ячейках, куда будут заполняться данные из формулы массивы не
 было иных данных, иначе будет ошибка.
 Переиспольхуем массив и сделаем из него линейный вертикальный массив данных
 Внесем в ячейку A9 такую формулу.
 ={A3A5; B3B5}
Обратить внимание на точку с запятой, которая разделяет два диапазона
 использованных внутри фигурных скобок.
 А теперь сделаем такой же массив, только поменяем местами колонки.
 ={B3B5, A3A5}
 Обратить внимание на запятую, которая разделяет два диапазона использованных
 внутри фигурных скобок.
 Также обратить внимание, что колонки поменялись местами по сравнению с
 исходным массивом.
 Важно! Во всех новых массивах данные обновятся автоматически если заменить в
 исходном массиве в ячейке A3
Мы делали одномерный (линейный) вертикальный массив из двумерного. А можно
 ли сделать одномерный но горизонтально расположенный?
 Да, при помощи функции TRANSPOSE.
 Функция TRANSPOSE полезна, когда вам нужно изменить ориентацию данных, чтобы
 они лучше соответствовали вашим потребностям в анализе или визуализации
 данных в Google Sheets.
 Функция TRANSPOSE в Google Sheets используется для транспонирования
 (переворачивания) диапазона данных. Транспонированиеизменяетрасположение
 данных,преобразуястрокивстолбцыистолбцывстроки.
 Функция TRANSPOSE принимает в качестве аргумента диапазон данных и
 возвращает тот же диапазон, но с перевернутой ориентацией.
 Вот синтаксис функции TRANSPOSE
 TRANSPOSEдиапазон)
 Где диапазон- это диапазон данных, который вы хотите транспонировать.
 Пример использования функции TRANSPOSE
 Предположим, у вас есть данные в диапазоне A1E5, и вы хотите транспонировать
 этот диапазон так, чтобы строки стали столбцами и столбцы стали строками. Вы
 можете использовать функцию TRANSPOSE следующим образом:
 TRANSPOSEA1E5
 После выполнения этой функции, вы получите тот же диапазон данных, но с
 измененной ориентацией, где столбцы стали строками, а строки- столбцами.
 Важно отметить, что диапазон данных, переданный в функцию TRANSPOSE, должен
 иметь одинаковое количество строк и столбцов, иначе это может вызвать ошибку.
 Также обратите внимание, что результат транспонирования будет отображаться в
 ячейках, начиная с той, в которой находится формула TRANSPOSE, и следующие
 ячейки будут заменены данными.
 В ячейку A18 поместим функцию:
 TRANSPOSE A3A5;B3B5})
 В результате получим такой же линейный массив, только расположенный
 горизонтально:
ИспользованиефункцииARRAYFUNCTION
 Возьмемпростойпримерсданнымигденеобходимопроизвестиумножениедвух
 чиселвкаждойячейке:
 Однако, еслиэтотнаборданныхбудетпополнятьсяснизу, нампридетсязаэтим
 следитьинезабыватьпротягиватьфункциювнизвсякийразкакрасширяетсянабор
 данных.
 Чтобы это автоматизировать, мы можем воспользоваться функцией массива
 ARRAYFUNCTONипереписатьнашуформулусложенияследующимобразом
 ARRAYFORMULAC2C15*D2D15)
 ФормулабудетпомещенатольковячейкеF2,еерезультатомбудетвертикальный
 массив данных, который автоматически расширяется на размерность массива
 описанноговформуле.Внашемслучаедостроки15.
 Длянаглядноститакжепокрасимавтоматическирассчитанныеячейкивсветлый
 тон, а ячейку с формулой в более темный тон того-же цвета. Это улучшит
 читаемостьданныхналисте.
Вот теперь все отлично! Теперь можно добавить еще одно полезное изменение для
 улучшения читаемости кода- поместим ARRAYFUNCTION в заголовок.
 Используем формулу фигурных скобок в заголовке, чтобы сделать вертикальный
 массив из двух элементов
 ={ заголовок ; формула }
 Важно отметить для студентов необходимость каждого элемента формулы
 ● знакаравно =
 ● фигурныхскобок { }
 ● разделителя точка с запятой ;
 ● заголовок- текст в двойных кавычках
 ● формула
 Таким образом в ячейке G1 добавляем формулу вида:
 ={"Total"; ARRAYFORMULAC2C15*D2D15)}
 , которая дает следующий результат:
ТеперьможноудалитьколонкуF
Задание для закрепления
 ● При помощи оператора { } перенести из листа ArrayFormula колонки Date,
 Product, Quantity.
 ● Добавить колонку с формулой которая вычисляет скидку в 10% от Price, если
 Quantity > 10 с помощью ARRAYFORMULA.
Полезные материалы
 1. Как применять условное форматирование в Google Таблицах
